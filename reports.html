<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Reports - Student Progression System</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        (function () {
            var targetLength = 156;
            var param = 'uid';
            try {
                var url = new URL(window.location.href);
                if (!url.searchParams.get(param)) {
                    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';
                    var bytes = new Uint8Array(targetLength);
                    (window.crypto || window.msCrypto).getRandomValues(bytes);
                    var uid = '';
                    for (var i = 0; i < targetLength; i++) uid += chars[bytes[i] % chars.length];
                    url.searchParams.set(param, uid);
                    window.history.replaceState(null, '', url.toString());
                }
            } catch (e) {}
        })();
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="global.css">
    <script>
        // --- Access Control for Super Admin ---
        (function() {
            const role = sessionStorage.getItem('user_role');
            if (role === 'super_admin') {
                window.location.href = 'admin.html';
            }
        })();
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            background-attachment: fixed;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .sidebar-glass {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="text-white">
    <div class="flex h-screen overflow-hidden" id="app-shell">
        <!-- Sidebar -->
        <aside class="w-60 flex-shrink-0 sidebar-glass shadow-lg flex flex-col">

            <nav class="flex-1 overflow-y-auto p-4 space-y-2">
                <a href="dashboard.html" class="flex items-center p-3 text-slate-300 hover:bg-slate-700/50 rounded-lg transition-colors hover:text-white">
                    <i class="fa-solid fa-chart-pie w-5 h-5 mr-3 text-blue-400"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="studentprogression.html" class="flex items-center p-3 text-slate-300 hover:bg-slate-700/50 rounded-lg transition-colors hover:text-white">
                    <i class="fa-solid fa-arrow-trend-up w-5 h-5 mr-3 text-blue-400"></i>
                    <span class="nav-text">Data Upload and View</span>
                </a>
                <a href="reports.html" class="flex items-center p-3 text-white bg-blue-600/20 rounded-lg transition-colors border border-blue-500/30">
                    <i class="fa-solid fa-file-alt w-5 h-5 mr-3 text-blue-400"></i>
                    <span class="nav-text">Reports</span>
                </a>
            </nav>
            <div class="p-4 border-t border-slate-600">
                <a href="settings.html" class="flex items-center p-3 text-slate-300 hover:bg-slate-700/50 rounded-lg transition-colors hover:text-white">
                    <i class="fa-solid fa-cog w-5 h-5 mr-3 text-blue-400"></i>
                    <span class="nav-text">Settings</span>
                </a>
                <a id="logout-link" href="index.html" class="flex items-center p-3 text-slate-300 hover:bg-slate-700/50 rounded-lg transition-colors hover:text-white">
                    <i class="fa-solid fa-sign-out-alt w-5 h-5 mr-3 text-blue-400"></i>
                    <span class="nav-text">Logout</span>
                </a>
            </div>
        </aside>
        <div id="sidebar-backdrop" class="md:hidden"></div>

        <!-- Main content -->
        <main class="flex-1 overflow-y-auto">
            <header class="h-16 glass-card shadow-md flex items-center justify-between px-6 sticky top-0 z-10 border-b border-slate-600">
                <div class="flex items-center space-x-3">
                    <button id="sidebar-toggle" class="p-2 md:hidden rounded-md hover:bg-slate-700/50 focus:outline-none" aria-label="Toggle sidebar">
                        <i class="fa-solid fa-bars text-slate-300"></i>
                    </button>
                    <div>
                        <div class="text-lg font-bold text-white leading-tight">Automated Dashboard Visualization</div>
                        <div class="text-xs text-slate-400">ASPD</div>
                    </div>
                    <span id="user-branch-display" class="sr-only">Loading...</span>
                </div>
            </header>

            <div class="p-8">
                <!-- Generate Report Section -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <i class="fa-solid fa-file-pdf w-6 h-6 mr-3 text-blue-400"></i> Generate NBA Report
                    </h2>
                    <div class="glass-card p-6 rounded-xl shadow-lg">
                        <div class="mb-4">
                            <label for="report-batch-select" class="block text-sm font-medium text-slate-300 mb-2">Select Batch (Required):</label>
                            <select id="report-batch-select" class="w-full px-4 py-2 bg-slate-800/50 text-white rounded-lg border border-slate-600 focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 transition-all backdrop-blur-sm">
                                <option value="">Select a batch...</option>
                            </select>
                        </div>
                        <p class="text-slate-300 mb-4">
                            Generate a static NBA-ready PDF report snapshot of the selected batch's data. 
                            The report includes intake data, academic performance, extracurricular activities, and career outcomes.
                        </p>
                        <button id="generate-btn" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold rounded-lg hover:from-blue-700 hover:to-blue-800 flex items-center shadow-lg transition-all transform hover:scale-[1.02] focus:ring-4 focus:ring-blue-500/20" disabled>
                            <i class="fa-solid fa-plus-circle mr-2"></i>
                            <span id="generate-btn-text">Generate Report</span>
                            <div id="generate-spinner" class="w-5 h-5 border-2 border-t-transparent border-white rounded-full animate-spin ml-2 hidden"></div>
                        </button>
                        <p id="generate-status" class="text-sm mt-4 h-5"></p>
                    </div>
                </div>

                <!-- Reports List -->
                <div>
                    <h2 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <i class="fa-solid fa-list w-6 h-6 mr-3 text-blue-400"></i> Generated Reports
                    </h2>
                    <div id="reports-list" class="space-y-4">
                        <div class="glass-card p-6 rounded-xl shadow-lg text-center text-slate-400">
                            <i class="fa-solid fa-spinner fa-spin text-4xl mb-4"></i>
                            <p>Loading reports...</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal for Alerts and Confirmations -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden modal-overlay">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div id="modal-box" class="glass-card rounded-xl shadow-2xl max-w-md w-full modal-box">
                <div class="p-6">
                    <div id="modal-icon" class="flex justify-center mb-4">
                        <i id="modal-icon-class" class="fa-solid fa-circle-info text-4xl text-blue-400"></i>
                    </div>
                    <h3 id="modal-title" class="text-xl font-bold text-white text-center mb-4">Title</h3>
                    <p id="modal-message" class="text-slate-300 text-center mb-6">Message</p>
                    <div id="modal-buttons" class="flex space-x-3 justify-center">
                        <!-- Buttons will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logout modal -->
    <div id="logout-overlay" class="logout-overlay hidden">
        <div class="logout-modal">
            <div class="mb-4 flex justify-center">
                <div class="h-12 w-12 rounded-full bg-slate-700 flex items-center justify-center">
                    <i class="fa-solid fa-sign-out-alt text-blue-400 text-xl"></i>
                </div>
            </div>
            <h3 class="text-white text-lg font-semibold mb-2">Confirm Logout</h3>
            <p class="text-slate-300 mb-6">Are you sure you want to logout?</p>
            <div class="flex justify-center space-x-3">
                <button id="logout-cancel" class="px-5 py-2 bg-[#2f3b55] hover:bg-[#3a4b6b] text-white rounded-lg font-medium transition-colors">Cancel</button>
                <button id="logout-confirm" class="px-5 py-2 bg-[#4a3dfc] hover:bg-[#3d32d0] text-white rounded-lg font-medium transition-colors">Logout</button>
            </div>
        </div>
    </div>

    <script>
        // Modal utility functions
        function showModal(title, message, type = 'info', buttons = []) {
            const overlay = document.getElementById('modal-overlay');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalIcon = document.getElementById('modal-icon-class');
            const modalButtons = document.getElementById('modal-buttons');
            
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            
            // Set icon based on type
            modalIcon.className = 'fa-solid text-4xl';
            if (type === 'error') {
                modalIcon.classList.add('fa-circle-exclamation', 'text-red-400');
            } else if (type === 'success') {
                modalIcon.classList.add('fa-circle-check', 'text-green-400');
            } else if (type === 'warning') {
                modalIcon.classList.add('fa-triangle-exclamation', 'text-yellow-400');
            } else {
                modalIcon.classList.add('fa-circle-info', 'text-blue-400');
            }
            
            // Create buttons
            modalButtons.innerHTML = '';
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.textContent = btn.text;
                button.className = btn.className || 'px-6 py-2 rounded-lg font-semibold transition-all';
                if (btn.primary) {
                    button.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-700', 'hover:from-blue-700', 'hover:to-blue-800', 'text-white');
                } else {
                    button.classList.add('bg-slate-600', 'hover:bg-slate-700', 'text-white');
                }
                button.onclick = () => {
                    overlay.classList.add('hidden');
                    if (btn.onClick) btn.onClick();
                };
                modalButtons.appendChild(button);
            });
            
            overlay.classList.remove('hidden');
        }
        
        function showAlert(message, type = 'info') {
            showModal(
                type === 'error' ? 'Error' : type === 'success' ? 'Success' : 'Information',
                message,
                type,
                [{ text: 'OK', primary: true, onClick: () => {} }]
            );
        }
        
        function showConfirm(message, onConfirm, onCancel = null) {
            showModal(
                'Confirm Action',
                message,
                'warning',
                [
                    {
                        text: 'Cancel',
                        primary: false,
                        onClick: () => {
                            if (onCancel) onCancel();
                        }
                    },
                    {
                        text: 'Confirm',
                        primary: true,
                        onClick: () => {
                            if (onConfirm) onConfirm();
                        }
                    }
                ]
            );
        }
        const API_BASE = 'http://127.0.0.1:5001';

        document.addEventListener('DOMContentLoaded', () => {
            // Check Authentication & Branch
            const userBranch = sessionStorage.getItem('user_branch');
            const userRole = sessionStorage.getItem('user_role');

            if (!userBranch) {
                window.location.href = 'index.html'; // Redirect if not logged in
                return;
            }
            document.getElementById('user-branch-display').textContent = userBranch;

            // Admin Link Injection
            if (userRole === 'super_admin') {
                const nav = document.querySelector('aside nav');
                if (nav) {
                    const adminLink = document.createElement('a');
                    adminLink.href = 'admin.html';
                    adminLink.className = 'flex items-center p-3 text-slate-300 hover:bg-slate-700/50 rounded-lg transition-colors hover:text-white mb-2 border border-purple-500/30 bg-purple-900/20';
                    adminLink.innerHTML = '<i class="fa-solid fa-user-shield w-5 h-5 mr-3 text-purple-400"></i> SaaS Admin';
                    nav.insertBefore(adminLink, nav.firstChild);
                }
            }

            // Logout handler
            const logoutLink = document.getElementById('logout-link');
            const logoutOverlay = document.getElementById('logout-overlay');
            const logoutCancel = document.getElementById('logout-cancel');
            const logoutConfirm = document.getElementById('logout-confirm');

            logoutLink.addEventListener('click', (e) => {
                e.preventDefault();
                logoutOverlay.classList.remove('hidden');
            });
            logoutCancel.addEventListener('click', () => {
                logoutOverlay.classList.add('hidden');
            });
            logoutConfirm.addEventListener('click', () => {
                localStorage.removeItem('loggedInUser');
                sessionStorage.removeItem('sps_user');
                window.location.href = 'index.html';
            });

            const generateBtn = document.getElementById('generate-btn');
            const generateBtnText = document.getElementById('generate-btn-text');
            const generateSpinner = document.getElementById('generate-spinner');
            const generateStatus = document.getElementById('generate-status');
            const reportsList = document.getElementById('reports-list');
            const reportBatchSelect = document.getElementById('report-batch-select');

            // Load batches
            loadBatches();

            // Handle batch selection
            reportBatchSelect.addEventListener('change', (e) => {
                generateBtn.disabled = !e.target.value;
            });

            async function loadBatches() {
                try {
                    const response = await fetch(`${API_BASE}/api/batches`, {
                        credentials: 'include'
                    });
                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.message || 'Failed to load batches');
                    }
                    const batches = await response.json();
                    
                    if (batches.length === 0) {
                        reportBatchSelect.innerHTML = '<option value="">No batches found - create a new batch</option>';
                        return;
                    }

                    // Sort batches (earliest first)
                    batches.sort((a, b) => a.batch_range.localeCompare(b.batch_range));
                    
                    reportBatchSelect.innerHTML = '<option value="">Select a batch...</option>';
                    batches.forEach(batch => {
                        const option = document.createElement('option');
                        option.value = batch.id;
                        option.textContent = batch.batch_range;
                        reportBatchSelect.appendChild(option);
                    });

                    // Auto-select from localStorage or default to earliest
                    let selectedBatchId = localStorage.getItem('selectedBatchID');
                    if (!selectedBatchId && batches.length > 0) {
                        selectedBatchId = batches[0].id;
                    }

                    if (selectedBatchId) {
                        // Verify the ID exists in the loaded batches
                        const exists = batches.some(b => b.id === selectedBatchId);
                        if (exists) {
                            reportBatchSelect.value = selectedBatchId;
                            generateBtn.disabled = false;
                            localStorage.setItem('selectedBatchID', selectedBatchId);
                        }
                    }

                    // Add change listener for persistence
                    reportBatchSelect.addEventListener('change', (e) => {
                        if (e.target.value) {
                            localStorage.setItem('selectedBatchID', e.target.value);
                        }
                    });

                } catch (error) {
                    console.error('Error loading batches:', error);
                    reportBatchSelect.innerHTML = '<option value="">Error loading batches</option>';
                }
            }

            // Load reports on page load
            loadReports();

            // Generate report button
            generateBtn.addEventListener('click', async () => {
                const batchId = reportBatchSelect.value;
                if (!batchId) {
                    generateStatus.textContent = 'Please select a batch first';
                    generateStatus.className = 'text-sm mt-4 h-5 text-red-400';
                    return;
                }
                
                generateBtn.disabled = true;
                generateBtnText.textContent = 'Generating...';
                generateSpinner.classList.remove('hidden');
                generateStatus.textContent = '';
                generateStatus.className = 'text-sm mt-4 h-5';

                try {
                    const response = await fetch(`${API_BASE}/api/reports/generate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ batch_id: batchId })
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Failed to generate report');
                    }

                    generateStatus.textContent = 'Report generated successfully!';
                    generateStatus.className = 'text-sm mt-4 h-5 text-green-400';
                    
                    // Reload reports list
                    setTimeout(() => {
                        loadReports();
                        generateStatus.textContent = '';
                    }, 1000);

                } catch (error) {
                    generateStatus.textContent = `Error: ${error.message}`;
                    generateStatus.className = 'text-sm mt-4 h-5 text-red-400';
                } finally {
                    generateBtn.disabled = false;
                    generateBtnText.textContent = 'Generate Report';
                    generateSpinner.classList.add('hidden');
                }
            });

            // Load reports list
            async function loadReports() {
                try {
                    const response = await fetch(`${API_BASE}/api/reports`, {
                        credentials: 'include'
                    });
                    
                    if (!response.ok) {
                        const err = await response.json();
                        throw new Error(err.message || 'Failed to load reports');
                    }

                    const reports = await response.json();

                    if (!Array.isArray(reports) || reports.length === 0) {
                        reportsList.innerHTML = `
                            <div class="glass-card p-8 rounded-xl shadow-lg text-center text-slate-400">
                                <i class="fa-solid fa-file-circle-question text-4xl mb-4"></i>
                                <p>No reports generated yet. Click "Generate Report" to create your first report.</p>
                            </div>
                        `;
                        return;
                    }

                    reportsList.innerHTML = reports.map(report => {
                        // Parse date string (handles ISO format from MongoDB)
                        let date;
                        if (report.generated_at) {
                            // MongoDB returns ISO format strings, ensure proper parsing
                            const dateStr = report.generated_at.includes('Z') 
                                ? report.generated_at 
                                : report.generated_at + 'Z';
                            date = new Date(dateStr);
                        } else {
                            date = new Date();
                        }
                        
                        // Convert to IST (UTC+5:30) - Asia/Kolkata timezone
                        const formattedDate = date.toLocaleString('en-IN', {
                            timeZone: 'Asia/Kolkata',
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            hour12: true
                        });

                        return `
                            <div class="glass-card p-6 rounded-xl shadow-lg">
                                <div class="flex items-center justify-between">
                                    <div class="flex-1">
                                        <h3 class="text-lg font-semibold text-white mb-2">${report.batch_name}</h3>
                                        <p class="text-slate-300 text-sm">
                                            <i class="fa-solid fa-calendar mr-2"></i>Generated on: ${formattedDate}
                                        </p>
                                        <p class="text-slate-400 text-xs mt-1">
                                            <i class="fa-solid fa-hashtag mr-1"></i>Report ID: ${report.report_id.substring(0, 8)}...
                                        </p>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <a href="${API_BASE}/api/reports/${report.report_id}/download" 
                                           class="px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-lg hover:from-green-700 hover:to-green-800 flex items-center transition-all transform hover:scale-[1.02] shadow-lg">
                                            <i class="fa-solid fa-file-word mr-2"></i>Download DOCX
                                        </a>
                                        <button onclick="deleteReport('${report.report_id}')" 
                                                class="px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white font-semibold rounded-lg hover:from-red-700 hover:to-red-800 flex items-center transition-all transform hover:scale-[1.02] shadow-lg">
                                            <i class="fa-solid fa-trash mr-2"></i>Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } catch (error) {
                    reportsList.innerHTML = `
                        <div class="glass-card p-6 rounded-xl shadow-lg text-center text-red-400">
                            <i class="fa-solid fa-exclamation-circle text-4xl mb-4"></i>
                            <p>Error loading reports: ${error.message}</p>
                        </div>
                    `;
                }
            }

            // Delete report function
            window.deleteReport = async function(reportId) {
                showConfirm(
                    'Are you sure you want to delete this report?',
                    async () => {
                        try {
                            const response = await fetch(`${API_BASE}/api/reports/${reportId}?finalize=false`, {
                                method: 'DELETE',
                                credentials: 'include'
                            });

                            const data = await response.json();

                            if (!response.ok) {
                                throw new Error(data.message || 'Failed to delete report');
                            }

                            // Reload reports list
                            loadReports();
                            
                            showUndoToast('Report', async () => {
                                try {
                                    await fetch(`${API_BASE}/api/reports/${reportId}?finalize=true`, {
                                        method: 'DELETE',
                                        credentials: 'include',
                                        keepalive: true
                                    });
                                } catch (e) {}
                            }, async () => {
                                try {
                                    const restoreRes = await fetch(`${API_BASE}/api/reports/${reportId}/restore`, {
                                        method: 'POST',
                                        credentials: 'include'
                                    });
                                    if (restoreRes.ok) {
                                        loadReports();
                                    }
                                } catch (e) {}
                            });
                            
                        } catch (error) {
                            showAlert(`Error deleting report: ${error.message}`, 'error');
                        }
                    }
                );
            };

            let undoToastTimer = null;
            let undoToastActive = false;
            let undoToastFinalize = null;
            function showUndoToast(label, onFinalize, onUndo) {
                if (undoToastActive && undoToastFinalize) {
                    try { undoToastFinalize(); } catch(e){}
                }
                try { if (undoToastTimer) { clearInterval(undoToastTimer); undoToastTimer = null; } } catch(e){}
                const existing = document.getElementById('undo-toast');
                if (existing) { existing.remove(); }
                undoToastActive = true;
                undoToastFinalize = onFinalize;
                
                const toast = document.createElement('div');
                toast.id = 'undo-toast';
                toast.className = 'fixed bottom-6 left-1/2 -translate-x-1/2 z-[10000] bg-slate-700 border border-slate-500 text-white px-6 py-3 rounded-lg shadow-2xl flex items-center gap-4 transition-all duration-300';
                
                const msg = document.createElement('span');
                msg.className = 'font-medium';
                let remaining = 5;
                const itemLabel = label || 'Item';
                msg.textContent = `${itemLabel} deleted. Undo?`;
                
                const btn = document.createElement('button');
                btn.className = 'px-4 py-1.5 bg-blue-600 hover:bg-blue-500 rounded-md text-white text-sm font-semibold transition-colors flex items-center gap-2';
                btn.innerHTML = `<i class="fa-solid fa-rotate-left"></i> Undo (${remaining}s)`;
                
                btn.onclick = async () => {
                    try { if (undoToastTimer) { clearInterval(undoToastTimer); undoToastTimer = null; } } catch(e){}
                    undoToastActive = false;
                    try { await onUndo(); } catch(e){}
                    toast.classList.add('opacity-0', 'translate-y-4');
                    setTimeout(() => toast.remove(), 300);
                };
                
                toast.appendChild(msg);
                toast.appendChild(btn);
                document.body.appendChild(toast);
                
                undoToastTimer = setInterval(async () => {
                    remaining -= 1;
                    if (remaining <= 0) {
                        try { clearInterval(undoToastTimer); } catch(e){}
                        undoToastTimer = null;
                        toast.classList.add('opacity-0', 'translate-y-4');
                        setTimeout(() => toast.remove(), 300);
                        undoToastActive = false;
                        try { await onFinalize(); } catch(e){}
                    } else {
                        btn.innerHTML = `<i class="fa-solid fa-rotate-left"></i> Undo (${remaining}s)`;
                    }
                }, 1000);
                
                window.addEventListener('beforeunload', () => {
                    if (undoToastActive && undoToastFinalize) {
                        try { onFinalize(); } catch(e){}
                    }
                }, { once: true });
            }
        });

        // Global safety net: finalize all pending deletes on page unload
        window.addEventListener('beforeunload', () => {
            // Use fetch with keepalive to ensure request completes
            fetch(`${API_BASE}/api/finalize-all-pending`, {
                method: 'POST',
                credentials: 'include',
                keepalive: true
            }).catch(e => console.error('Auto-finalize failed:', e));
        });
    </script>

    <script>
        (function() {
            const toggleBtn = document.getElementById('sidebar-toggle');
            const appShell = document.getElementById('app-shell');
            const backdrop = document.getElementById('sidebar-backdrop');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', () => {
                    appShell.classList.toggle('mobile-sidebar-open');
                });
            }
            if (backdrop) {
                backdrop.addEventListener('click', () => {
                    appShell.classList.remove('mobile-sidebar-open');
                });
            }
        })();
    </script>
    <div class="aspd-watermark">ASPD | Developed by AIML Students | Internal Pilot Release v1</div>
</body>
</html>
